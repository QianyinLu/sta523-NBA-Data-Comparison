---
title: "Project_report"
author: "Conjugate Family"
date: "12/10/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
suppressMessages(library(tidyverse))
suppressMessages(library(shiny))
```

## Read Data

```{r}
James <- readRDS("data/james.rds")
Durant <- readRDS("data/durant.rds")
Image <- readRDS("data/image.rds")
```

```{r}
ui <- fixedPage(
  navbarPage(title = "James VS Durant",
             tabPanel(title = "Basic",
           h1("Regular & Playoff"),
           h2("Statistics Comparison"),
           selectInput(inputId = "rpType",
                       label = "Statistics you wish to compare",
                       choices = c("Minute", "Points", "Rebound", "Assist",
                                   "Block", "Steal", "Field Goal Percentage",
                                   "3-Point Percentage", "Free Shoot Percentage")),
           fixedRow(
             column(width = 6, plotOutput(outputId = "JrpPlot")),
             column(width = 6, plotOutput(outputId = "DrpPlot"))
           ),
           h2("Data Comparison"),
           fixedRow(
             column(width = 6,
                    selectInput(inputId = "JrpSeason", label = "Lebron James",
                                choices = unique(James$avg$season))
             ),
             column(width = 6,
                    selectInput(inputId = "DrpSeason", label = "Kevin Durant",
                                choices = unique(Durant$avg$season))
             )
           ),
           fixedRow(
             column(width = 3,
                       htmlOutput(outputId = "Jimage1")),
             column(width = 3,
                       DT::dataTableOutput(outputId = "Jrpdata")),
             column(width = 3,
                      DT::dataTableOutput(outputId = "Drpdata")),
             column(width = 3,
                       htmlOutput(outputId = "Dimage1"))
             )
   ),
  tabPanel(title = "Advanced",
           sidebarLayout(
              sidebarPanel(
                uiOutput(outputId = "player_photo"),
                selectInput(inputId = "player_name",
                            label = "Player",
                            choices = c("Kevin Durant", "Lebron James")),
                
                conditionalPanel(
                  condition = "input.player_name == \"Kevin Durant\"",
                  selectInput(inputId = "season_D",
                              label = "Season",
                              choices = unique(Durant$avg$season))
                  ),
                conditionalPanel(
                  condition = "input.player_name == \"Lebron James\"",
                  selectInput(inputId = "season_J",
                              label = "Season",
                              choices = unique(James$avg$season))
                  ),
                radioButtons(inputId = "season_type",
                             label = "Season Type",
                             choices = c("Regular Season", "Playoffs")),
                radioButtons(inputId = "court_theme",
                       label = "Theme",
                       choices = c("Light", "Dark"),
                       selected = "Light")
                ),
              mainPanel(
                h2(textOutput("chart_header_player")),
                h4(textOutput("chart_header_info")),
                h4(textOutput("chart_header_team")),
                plotOutput("court"),
                h3(textOutput("summary_stats_header")),
                tableOutput("summary_stats")
                )
              )
           )
  )
)
  
server <- function(input, output){
  output$court <- renderPlot({
    ggplot(data = James$avg) +
      geom_point(aes(x = season, y = MIN, colour = regular), size = 3)
  })
  
  output$chart_header_player <- renderText({
    input$player_name
  })
  output$chart_header_info <- renderText({
    if(input$player_name == "Lebron James"){
      paste(input$season_J, input$season_type)
    }
    else{
      paste(input$season_D, input$season_type)
    }
  })
  output$chart_header_team <- renderText({
    "Golden States Warriors"
  })
  
  output$JrpPlot <- renderPlot({
    g <- ggplot(data = James$avg)
    if(input$rpType == "Minute"){
      g <- g +
        geom_point(aes(x = season, y = MIN, colour = regular), size = 3)
    }
    if(input$rpType == "Points"){
      g <- g +
        geom_point(aes(x = season, y = PTS, colour = regular), size = 3)
    }
    if(input$rpType == "Rebound"){
      g <- g +
        geom_point(aes(x = season, y = REB, colour = regular), size = 3)
    }
    if(input$rpType == "Assist"){
      g <- g +
        geom_point(aes(x = season, y = AST, colour = regular), size = 3)
    }
    if(input$rpType == "Block"){
      g <- g +
        geom_point(aes(x = season, y = BLK, colour = regular), size = 3)
    }
    if(input$rpType == "Steal"){
      g <- g +
        geom_point(aes(x = season, y = STL, colour = regular), size = 3)
    }
    if(input$rpType == "Field Goal Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `FG%`, colour = regular), size = 3)
    }
    if(input$rpType == "3-Point Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `3P%`, colour = regular), size = 3)
    }
    if(input$rpType == "Free Shoot Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `FTA`, colour = regular), size = 3)
    }
    g +
      labs(title = paste(input$rpType, "For Lebron James"),
           x = "Season",
           y = input$rpType) +
      theme_light() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
            title = element_text(size = 20))
  })
  output$DrpPlot <- renderPlot({
    g <- ggplot(data = Durant$avg)
    if(input$rpType == "Minute"){
      g <- g +
        geom_point(aes(x = season, y = MIN, colour = regular), size = 3)
    }
    if(input$rpType == "Points"){
      g <- g +
        geom_point(aes(x = season, y = PTS, colour = regular), size = 3)
    }
    if(input$rpType == "Rebound"){
      g <- g +
        geom_point(aes(x = season, y = REB, colour = regular), size = 3)
    }
    if(input$rpType == "Assist"){
      g <- g +
        geom_point(aes(x = season, y = AST, colour = regular), size = 3)
    }
    if(input$rpType == "Block"){
      g <- g +
        geom_point(aes(x = season, y = BLK, colour = regular), size = 3)
    }
    if(input$rpType == "Steal"){
      g <- g +
        geom_point(aes(x = season, y = STL, colour = regular), size = 3)
    }
    if(input$rpType == "Field Goal Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `FG%`, colour = regular), size = 3)
    }
    if(input$rpType == "3-Point Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `3P%`, colour = regular), size = 3)
    }
    if(input$rpType == "Free Shoot Percentage"){
      g <- g +
        geom_point(aes(x = season, y = `FTA`, colour = regular), size = 3)
    }
    g +
      labs(title = paste(input$rpType, "For Kevin Durant"),
           x = "Season",
           y = input$rpType) +
      theme_light() +
      theme(axis.text.x = element_text(angle = 45, hjust = 1, size = 10),
            title = element_text(size = 20))
  })
  
  rp.data <- function(df, target){
    data <- df %>%
      filter(season == target) %>%
      select(MIN, PTS, REB, AST, BLK, STL, `FG%`, `3P%`, `FTA`, regular)
    rownames(data) <- data$regular
    data <- select(data, -regular)
    as.data.frame(t(as.matrix.data.frame(data)))
  }
  
  output$Jrpdata <- DT::renderDataTable({
    rp.data(James$avg, input$JrpSeason)
  })
  
  output$Drpdata <- DT::renderDataTable({
    rp.data(Durant$avg, input$DrpSeason)
  })
  
  createImage <- function(url){
    sprintf('<img src="%s" height="250" width ="250"></img>', url)
  }
  
  output$Jimage1 <- renderText({
       createImage(Image$James.Heat[2])
    })
}

shinyApp(ui, server)
```

